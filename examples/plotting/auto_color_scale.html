<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/png" sizes="310x346" href="../../_static/qcodes_favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Auto Color Scale &mdash; QCoDeS 0.27.0.dev9139 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=9e84aeb3"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="QCoDeS Example with Keysight E4980A LCR meter" href="../driver_examples/QCoDeS%20Example%20with%20Keysight%20E4980A%20LCR%20meter.html" />
    <link rel="prev" title="How to use Plottr with QCoDeS for live plotting?" href="How-to-use-Plottr-with-QCoDeS-for-live-plotting.html" />
    <link href="../../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            QCoDeS
          </a>
              <div class="version">
                0.27.0.dev9139+main.g009ec80fb
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../start/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../15_minutes_to_QCoDeS.html">15 minutes to QCoDeS</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Examples of using QCoDeS</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#basic-examples">Basic examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#parameters">Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#dataset">DataSet</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#plotting">Plotting</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="How-to-use-Plottr-with-QCoDeS-for-live-plotting.html">How to use Plottr with QCoDeS for live plotting?</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Auto Color Scale</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#TL;DR">TL;DR</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Table-of-contents">Table of contents</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Introduction-to-the-problem-and-risks">Introduction to the problem and risks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Using-the-automatic-color-scale">Using the automatic color scale</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Details-of-the-calculation">Details of the calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Cutoff-Percentiles">Cutoff Percentiles</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Defaults-and-customizing-the-auto-color-scaling">Defaults and customizing the auto color scaling</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Using-auto-color-scaling-in-custom-plotting">Using auto color scaling in custom plotting</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#drivers">Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#writing-drivers">Writing Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#logging">Logging</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../community/index.html">Community Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dataset/index.html">DataSet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">QCoDes API documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../drivers_api/index.html">Instrument Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changes/index.html">Changelogs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../help.html">Get Help</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">QCoDeS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Examples of using QCoDeS</a></li>
      <li class="breadcrumb-item active">Auto Color Scale</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/examples/plotting/auto_color_scale.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="admonition note">
  <p>This page was generated from
    <a class="reference external"
    href="https://github.com/qcodes/qcodes/blob/main/docs/examples/plotting/auto_color_scale.ipynb">docs/examples/plotting/auto_color_scale.ipynb</a>.
    Interactive online version:
    <a href="https://mybinder.org/v2/gh/qcodes/qcodes/main?filepath=docs/examples/plotting/auto_color_scale.ipynb"><img
alt="Binder badge"
    src="https://mybinder.org/badge_logo.svg"
    style="vertical-align:text-bottom"></a>.
  </p>
  <script>
    if (document.location.host) {
      var p = document.currentScript.previousSibling.previousSibling;
      var a = document.createElement('a');
      a.innerHTML = 'View in <em>nbviewer</em>';
      a.href = `https://nbviewer.jupyter.org/url${
        (window.location.protocol == 'https:' ? 's/' : '/') +
        window.location.host +
        window.location.pathname.slice(0, -4) }ipynb`;
      a.classList.add('reference');
      a.classList.add('external');
      p.appendChild(a);
      p.appendChild(document.createTextNode('.'));
    }
  </script>
</div><section id="Auto-Color-Scale">
<h1>Auto Color Scale<a class="headerlink" href="#Auto-Color-Scale" title="Link to this heading"></a></h1>
<section id="TL;DR">
<h2>TL;DR<a class="headerlink" href="#TL;DR" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>use <code class="docutils literal notranslate"><span class="pre">plot_by_id(run_id,</span> <span class="pre">auto_color_scale=True,</span> <span class="pre">cutoff_percentile=(0.5,</span> <span class="pre">0.6)</span></code> to enable automatic color scaling</p></li>
<li><p>this maximally cuts 0.5% of the low valued data points and 0.6% of the high valued data points.</p></li>
<li><p>You can also use it for matplotlib with the supplied auto scaling function.</p></li>
<li><p>Set your defaults in <code class="docutils literal notranslate"><span class="pre">qcodesrc.json</span></code>.</p></li>
</ul>
</section>
<section id="Table-of-contents">
<h2>Table of contents<a class="headerlink" href="#Table-of-contents" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#Introduction-to-the-problem-and-risks"><span class="std std-ref">Introduction to the problem and risks</span></a></p></li>
<li><p><a class="reference internal" href="#Using-the-automatic-color-scale"><span class="std std-ref">Using the automatic color scale</span></a></p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#Example-1:-outliers-in-homogeneous-data"><span class="std std-ref">Example 1: outliers in homogeneous data</span></a></p></li>
</ol>
</li>
<li><p><a class="reference internal" href="#Details-of-the-calculation"><span class="std std-ref">Details of the calculation</span></a></p></li>
<li><p><a class="reference internal" href="#Cutoff-Percentiles"><span class="std std-ref">Cutoff Percentiles</span></a></p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#Example-2:-data-on-noisy-background-with-outliers"><span class="std std-ref">Example 2: data on noisy background with outliers</span></a></p></li>
</ol>
</li>
<li><p><a class="reference internal" href="#Defaults-and-customizing-the-auto-color-scaling"><span class="std std-ref">Defaults and customizing the auto color scaling</span></a></p></li>
<li><p><a class="reference internal" href="#Using-auto-color-scaling-in-custom-plotting"><span class="std std-ref">Using auto color scaling in custom plotting</span></a></p></li>
</ol>
</section>
<section id="Introduction-to-the-problem-and-risks">
<h2>Introduction to the problem and risks<a class="headerlink" href="#Introduction-to-the-problem-and-risks" title="Link to this heading"></a></h2>
<p>It is a fairly common issue that a heat map plot does not properly show the right details due to some outliers that push the range of the color scale beyond the desired limits, as it is shown in the image below: <img alt="image0" src="../../_images/auto_color_scale_swamped_small.png" /> Here there are two pixels (black and white) corresponding to high and low outliers. The remaining data is uniformly displayed as red and the actual structure of it is drowned. One can of course specify the limits of the color bar manually to view the full structure as shown
here: <img alt="image1" src="../../_images/auto_color_scale_clean_small.png" /> But for measurements that takes a lot of time to perform, manual intervention becomes an unwieldy task.</p>
<p>In this notebook an <em>automatic color scaling</em> is presented that tries to empower the experimenter to circumvent this difficulty, while keeping possible risks in mind.</p>
<p>The risk narrowing the color scale is clearly that the image representing the data saturates in some regions and is no longer fully representative of the actual data. Especially for automatic color scaling this can become risky because without a theoretical model describing the specific measurement one cannot scientifically argue for the choice of the new limits of the color scale and possible meaningful features might be disregarded.</p>
<p>For this reason automatic color scaling is deactivated by default and has to be activated manually.</p>
</section>
<section id="Using-the-automatic-color-scale">
<h2>Using the automatic color scale<a class="headerlink" href="#Using-the-automatic-color-scale" title="Link to this heading"></a></h2>
<p>The following section presents an example of the usage of the automatic color scaling with the new <code class="docutils literal notranslate"><span class="pre">DataSet</span></code> and the <code class="docutils literal notranslate"><span class="pre">plot_dataset</span></code> function for plotting. Let’s first make the necessary imports:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># store data in a separate db in order not to spam the actual measurement db</span>
<span class="kn">from</span> <span class="nn">qcodes.dataset</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">initialise_or_create_database_at</span><span class="p">,</span>
    <span class="n">load_or_create_experiment</span><span class="p">,</span>
    <span class="n">new_data_set</span><span class="p">,</span>
    <span class="n">plot_dataset</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">initialise_or_create_database_at</span><span class="p">(</span><span class="s1">&#39;../example.db&#39;</span><span class="p">)</span>

<span class="c1"># create an experiment for this tutorial</span>
<span class="n">load_or_create_experiment</span><span class="p">(</span><span class="n">experiment_name</span><span class="o">=</span><span class="s1">&#39;tutorial_auto_color_scale&#39;</span><span class="p">,</span> <span class="n">sample_name</span><span class="o">=</span><span class="s2">&quot;outliers&quot;</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Logging hadn&#39;t been started.
Activating auto-logging. Current session state plus future input saved.
Filename       : /home/runner/.qcodes/logs/command_history.log
Mode           : append
Output logging : True
Raw input log  : False
Timestamping   : True
State          : active
Qcodes Logfile : /home/runner/.qcodes/logs/240704-5731-qcodes.log
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
tutorial_auto_color_scale#outliers#1@/home/runner/work/Qcodes/Qcodes/docs/examples/example.db
---------------------------------------------------------------------------------------------
</pre></div></div>
</div>
<section id="Example-1:-outliers-in-homogeneous-data">
<h3>Example 1: outliers in homogeneous data<a class="headerlink" href="#Example-1:-outliers-in-homogeneous-data" title="Link to this heading"></a></h3>
<p>Here we basically reproduce the images of the introduction, where we have some smoothly structured data with some outliers that lie far outside of the range of the remaining data:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># first we generate a fake dataset with outliers.</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">qcodes.dataset.descriptions.dependencies</span> <span class="kn">import</span> <span class="n">InterDependencies_</span>
<span class="kn">from</span> <span class="nn">qcodes.dataset.descriptions.param_spec</span> <span class="kn">import</span> <span class="n">ParamSpecBase</span>


<span class="k">def</span> <span class="nf">dataset_with_outliers_generator</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">data_offset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">low_outlier</span><span class="o">=-</span><span class="mi">3</span><span class="p">,</span>
                 <span class="n">high_outlier</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">background_noise</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">ParamSpecBase</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;numeric&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Flux&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;e^2/hbar&#39;</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">ParamSpecBase</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;numeric&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">ParamSpecBase</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;numeric&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Majorana number&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;Anyon&#39;</span><span class="p">)</span>

    <span class="n">idps</span> <span class="o">=</span> <span class="n">InterDependencies_</span><span class="p">(</span><span class="n">dependencies</span><span class="o">=</span><span class="p">{</span><span class="n">z</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">)})</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">set_interdependencies</span><span class="p">(</span><span class="n">idps</span><span class="p">)</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">mark_started</span><span class="p">()</span>

    <span class="n">npoints</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">xvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">npoints</span><span class="p">)</span>
    <span class="n">tvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">npoints</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">counter</span><span class="p">,</span> <span class="n">xv</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xvals</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">background_noise</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="n">counter</span> <span class="o">&lt;</span> <span class="nb">round</span><span class="p">(</span><span class="n">npoints</span><span class="o">/</span><span class="mf">2.3</span><span class="p">)</span> <span class="ow">or</span> <span class="n">counter</span> <span class="o">&gt;</span> <span class="nb">round</span><span class="p">(</span><span class="n">npoints</span><span class="o">/</span><span class="mf">1.8</span><span class="p">)):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">npoints</span><span class="p">)</span><span class="o">-</span><span class="n">data_offset</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">xv</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">npoints</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">counter</span> <span class="o">==</span> <span class="nb">round</span><span class="p">(</span><span class="n">npoints</span><span class="o">/</span><span class="mf">1.9</span><span class="p">):</span>
            <span class="n">data</span><span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">npoints</span><span class="o">/</span><span class="mf">1.9</span><span class="p">)]</span> <span class="o">=</span> <span class="n">high_outlier</span>
        <span class="k">if</span> <span class="n">counter</span> <span class="o">==</span> <span class="nb">round</span><span class="p">(</span><span class="n">npoints</span><span class="o">/</span><span class="mf">2.1</span><span class="p">):</span>
            <span class="n">data</span><span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">npoints</span><span class="o">/</span><span class="mf">2.5</span><span class="p">)]</span> <span class="o">=</span> <span class="n">low_outlier</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">add_results</span><span class="p">([{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">xv</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="n">tv</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="n">z</span><span class="p">}</span>
                            <span class="k">for</span> <span class="n">z</span><span class="p">,</span> <span class="n">tv</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">tvals</span><span class="p">)])</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">mark_completed</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ds</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a new dataset with outliers</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">dataset_with_outliers_generator</span><span class="p">(</span><span class="n">new_data_set</span><span class="p">(</span><span class="s1">&#39;data_with_outliers&#39;</span><span class="p">),</span>
                                     <span class="n">low_outlier</span><span class="o">=-</span><span class="mi">3</span><span class="p">,</span> <span class="n">high_outlier</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                     <span class="n">background_noise</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>by plotting it simply by <code class="docutils literal notranslate"><span class="pre">plot_dataset</span></code> we get the full range</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span><span class="p">,</span> <span class="n">cb</span> <span class="o">=</span> <span class="n">plot_dataset</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_plotting_auto_color_scale_10_0.png" src="../../_images/examples_plotting_auto_color_scale_10_0.png" />
</div>
</div>
<p>By adding the keyword <code class="docutils literal notranslate"><span class="pre">auto_color_scale=True</span></code> one activates the scaling:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span><span class="p">,</span> <span class="n">cb</span> <span class="o">=</span> <span class="n">plot_dataset</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">auto_color_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_plotting_auto_color_scale_12_0.png" src="../../_images/examples_plotting_auto_color_scale_12_0.png" />
</div>
</div>
<p>and the actual structure of the data becomes visible.</p>
<p>Please note two further details: - The triangles that appeared at the top and the bottom of the color bar: These indicate that the color bar does not cover the full range of the data spectrum. - The clipped regions are marked with colors that are clearly not part of the color scale in order to clearly separate those regions where we cannot make any claim about any structure.</p>
</section>
</section>
<section id="Details-of-the-calculation">
<h2>Details of the calculation<a class="headerlink" href="#Details-of-the-calculation" title="Link to this heading"></a></h2>
<p>The new limits are calculated in three steps: - Determine the inter quartile range (IQR), i.e. the distance between the first (q1) and the third (q3) quartile (see image below). - Expand the region spanned by [q1, q3] by 1.5 x the IQR (yet not beyond the original limits of the min/max of the data). - Limit the amount of data points clipped on each side to an amount that is described by the lower (pl) and upper (pu) cutoff percentiles. E.g. for pu=pl=0.5%, no more the white and gray areas may not
take up more than half a percent each of the total area.</p>
<p>To understand how this works lets consider the histogram of the previous example:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">get_parameter_data</span><span class="p">()[</span><span class="s2">&quot;z&quot;</span><span class="p">][</span><span class="s2">&quot;z&quot;</span><span class="p">]</span>

<span class="n">pl</span><span class="p">,</span> <span class="n">q3</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">pu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="mi">97</span><span class="p">,</span><span class="mi">75</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="c1"># IQR</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">q3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="c1"># cut off</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">q1</span><span class="o">-</span><span class="mf">1.5</span><span class="o">*</span><span class="p">(</span><span class="n">q3</span><span class="o">-</span><span class="n">q1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">q3</span><span class="o">+</span><span class="mf">1.5</span><span class="o">*</span><span class="p">(</span><span class="n">q3</span><span class="o">-</span><span class="n">q1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="c1"># limit through percentiles</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">pl</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">pu</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.lines.Line2D at 0x7f3c49facc50&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_plotting_auto_color_scale_15_1.png" src="../../_images/examples_plotting_auto_color_scale_15_1.png" />
</div>
</div>
<p>The black lines mark q1 and q3 and the blue lines correspond to the interval widened by 1.5 x IQR. The red lines present the lines of the percentile cutoff, in this case 3% on each side. The red lines limit how much of the data may be cut away through the blue lines. In this specific case of 3% they are not limiting the cutoff through the IQR estimation. Please also note the barely filled bins at +-10, that represent the outliers. The new color scale therefore roughly corresponds to a threefold
increase of the steepness of color gradient.</p>
</section>
<section id="Cutoff-Percentiles">
<h2>Cutoff Percentiles<a class="headerlink" href="#Cutoff-Percentiles" title="Link to this heading"></a></h2>
<p>Limiting the effect of an automatic color scale by the cutoff percentiles can be very important. To understand that consider the following example:</p>
<section id="Example-2:-data-on-noisy-background-with-outliers">
<h3>Example 2: data on noisy background with outliers<a class="headerlink" href="#Example-2:-data-on-noisy-background-with-outliers" title="Link to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a new dataset with outliers</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">dataset_with_outliers_generator</span><span class="p">(</span><span class="n">new_data_set</span><span class="p">(</span><span class="s1">&#39;data_outside_iqr&#39;</span><span class="p">),</span>
                                     <span class="n">data_offset</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">low_outlier</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span>
                                     <span class="n">high_outlier</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span><span class="p">,</span> <span class="n">cb</span> <span class="o">=</span> <span class="n">plot_dataset</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_plotting_auto_color_scale_21_0.png" src="../../_images/examples_plotting_auto_color_scale_21_0.png" />
</div>
</div>
<p>In this example dataset the region of interest shall be represented by the center region. Again there are outliers that render the color grading almost useless.</p>
<p>Looking at the same plot with an automatic color scale without limiting cutoff percentiles (by setting the cutoff to 50% we basically deactivate them) does not give a better result:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span><span class="p">,</span> <span class="n">cb</span> <span class="o">=</span> <span class="n">plot_dataset</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">auto_color_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cutoff_percentile</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_plotting_auto_color_scale_23_0.png" src="../../_images/examples_plotting_auto_color_scale_23_0.png" />
</div>
</div>
<p>Here all the relevant region is considered as outliers. To make this clearer let’s draw the histogram again:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">get_parameter_data</span><span class="p">()[</span><span class="s2">&quot;z&quot;</span><span class="p">][</span><span class="s2">&quot;z&quot;</span><span class="p">]</span>
<span class="n">pl</span><span class="p">,</span> <span class="n">q3</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">pu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="mf">99.5</span><span class="p">,</span><span class="mi">75</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="c1"># IQR</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">q3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="c1"># cut off</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">q1</span><span class="o">-</span><span class="mf">1.5</span><span class="o">*</span><span class="p">(</span><span class="n">q3</span><span class="o">-</span><span class="n">q1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">q3</span><span class="o">+</span><span class="mf">1.5</span><span class="o">*</span><span class="p">(</span><span class="n">q3</span><span class="o">-</span><span class="n">q1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="c1"># limit through percentiles</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">pl</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">pu</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.lines.Line2D at 0x7f3c49c70890&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_plotting_auto_color_scale_25_1.png" src="../../_images/examples_plotting_auto_color_scale_25_1.png" />
</div>
</div>
<p>The region of interest is represented by the right hand side structure around 0. The IQR induced limits (blue) does not capture these values. The percentile limits (0.5% here) however save the day:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span><span class="p">,</span> <span class="n">cb</span> <span class="o">=</span> <span class="n">plot_dataset</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">auto_color_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cutoff_percentile</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_plotting_auto_color_scale_27_0.png" src="../../_images/examples_plotting_auto_color_scale_27_0.png" />
</div>
</div>
<p>There is some undesired clipping in the top right corner of the ROI but the structure within the ROI is relatively well resolved.</p>
</section>
<section id="Asymmetric-cutoffs">
<h3>Asymmetric cutoffs<a class="headerlink" href="#Asymmetric-cutoffs" title="Link to this heading"></a></h3>
<p>Asymmetric cutoffs can be simply defined via a tuples. So for the data of the first example we can disregard the lower outliers that take up up to five percent of the data but not allow any clipping on the upper end:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span> <span class="o">=</span> <span class="n">dataset_with_outliers_generator</span><span class="p">(</span><span class="n">new_data_set</span><span class="p">(</span><span class="s1">&#39;data_with_outliers&#39;</span><span class="p">),</span>
                                     <span class="n">low_outlier</span><span class="o">=-</span><span class="mi">3</span><span class="p">,</span>
                                     <span class="n">high_outlier</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                     <span class="n">background_noise</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="p">,</span> <span class="n">cb</span> <span class="o">=</span> <span class="n">plot_dataset</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">auto_color_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cutoff_percentile</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_plotting_auto_color_scale_30_0.png" src="../../_images/examples_plotting_auto_color_scale_30_0.png" />
</div>
</div>
</section>
</section>
<section id="Defaults-and-customizing-the-auto-color-scaling">
<h2>Defaults and customizing the auto color scaling<a class="headerlink" href="#Defaults-and-customizing-the-auto-color-scaling" title="Link to this heading"></a></h2>
<p>The defaults used by <code class="docutils literal notranslate"><span class="pre">plot_dataset</span></code> can be set in the <code class="docutils literal notranslate"><span class="pre">qcodesrc.json</span></code> files. The system default is described in <code class="docutils literal notranslate"><span class="pre">qcodes/config/qcodesrc.json</span></code> (<a class="reference external" href="https://github.com/QCoDeS/Qcodes/blob/main/qcodes/config/qcodesrc.json">online</a>) To override the default edit these values in your custom <code class="docutils literal notranslate"><span class="pre">qcodesrc.json</span></code> file in your home directory.</p>
<p>The defaults are (for detailed description see the schema file)</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&quot;auto_color_scale&quot;:{
    &quot;enabled&quot;: false,
    &quot;cutoff_percentile&quot;: [0.5, 0.5],
    &quot;color_over&quot;: &quot;white&quot;,
    &quot;color_under&quot;: &quot;gray&quot;
}
</pre></div>
</div>
<p>Because of the possible risks due to auto color scaling it is deactivated by default. Please remember to change the colors marking the outliers in case you should use a color map the includes white and gray.</p>
</section>
<section id="Using-auto-color-scaling-in-custom-plotting">
<h2>Using auto color scaling in custom plotting<a class="headerlink" href="#Using-auto-color-scaling-in-custom-plotting" title="Link to this heading"></a></h2>
<p>If you are using matplotlib but do not want to rely on <code class="docutils literal notranslate"><span class="pre">plot_dataset</span></code>, you can simply call: <code class="docutils literal notranslate"><span class="pre">qcodes.utils.plotting.apply_auto_color_scale(colorbar,</span> <span class="pre">...)</span></code> and provide any matplotlib color bar to achieve the described effects.</p>
<p>If you want to use the qcodes config system for defaults call <code class="docutils literal notranslate"><span class="pre">qcodes.utils.plotting.auto_color_scale_from_config(colorbar,...)</span></code> instead.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="How-to-use-Plottr-with-QCoDeS-for-live-plotting.html" class="btn btn-neutral float-left" title="How to use Plottr with QCoDeS for live plotting?" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../driver_examples/QCoDeS%20Example%20with%20Keysight%20E4980A%20LCR%20meter.html" class="btn btn-neutral float-right" title="QCoDeS Example with Keysight E4980A LCR meter" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>